# üî≠ Colab Spectral Fitting Project

‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡πÄ‡∏õ‡∏Å‡∏ï‡∏£‡∏±‡∏°‡∏£‡∏±‡∏á‡∏™‡∏µ‡πÄ‡∏≠‡∏Å‡∏ã‡πå (X-ray Spectral Fitting) ‡∏ö‡∏ô Google Colab ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏°‡∏≤‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡πÑ‡∏î‡πâ ‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏´‡∏ô‡∏±‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á

**‚ú® ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà:** ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ Fit ‡πÅ‡∏ö‡∏ö‡∏•‡∏π‡∏Å‡πÇ‡∏ã‡πà (Chain Fit) ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏™‡∏°‡∏Å‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏ó‡∏≤‡∏á‡∏ü‡∏¥‡∏™‡∏¥‡∏Å‡∏™‡πå‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô

## üìÇ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ

```
Colab_Spectral_Fitting/
‚îú‚îÄ‚îÄ data_loader.py           # üìä Core Logic: ‡πÑ‡∏ü‡∏•‡πå‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ü‡∏¥‡∏™‡∏¥‡∏Å‡∏™‡πå
‚îú‚îÄ‚îÄ spectral_analysis.ipynb  # üìì User Interface: Notebook ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
‚îú‚îÄ‚îÄ Models/                  # üì¶ Spectral Models Library
‚îî‚îÄ‚îÄ README.md                # üìñ ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
```

## üöÄ ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Workflow ‡πÉ‡∏´‡∏°‡πà)

1. **Upload & Mount**: ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Ç‡∏∂‡πâ‡∏ô Drive ‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ô Cell ‡πÅ‡∏£‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
2. **Config (Section 1)**: ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡πà‡∏ß‡∏á Energy ‡πÅ‡∏•‡∏∞ Path ‡πÑ‡∏ü‡∏•‡πå
3. **Load & Inspect (Section 2)**: ‡∏£‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡∏£‡∏≤‡∏ü Energy Range (‡πÄ‡∏™‡πâ‡∏ô‡∏õ‡∏£‡∏∞‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô)
4. **Step-by-Step Exploration (Section 3)**: ‡∏£‡∏±‡∏ô‡∏ó‡∏µ‡∏•‡∏∞ Cell ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏•‡∏≠‡∏á Model ‡πÅ‡∏ö‡∏ö Chain Fit
5. **Final Fit (Section 4)**: ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå

---

## üìö Mathematical Reference (‡∏™‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì)

*(‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏´‡∏≤‡∏Å‡∏≠‡πà‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö LaTeX ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤)*

### 1. Spectral Models (‡∏™‡∏°‡∏Å‡∏≤‡∏£‡∏ü‡∏¥‡∏™‡∏¥‡∏Å‡∏™‡πå)
‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏£‡∏ß‡∏°‡∏™‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡∏ó‡∏§‡∏©‡∏é‡∏µ **F(E)**:

*   **Power-law** (‡∏Å‡∏≤‡∏£‡πÅ‡∏ú‡πà‡∏£‡∏±‡∏á‡∏™‡∏µ‡∏´‡∏•‡∏±‡∏Å):
    > `F_pl(E) = Norm * E^(-Gamma)`
    *   **Norm**: Normalization (‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏°)
    *   **Gamma (Œì)**: Photon Index (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏ô)

*   **Blackbody** (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô‡∏à‡∏≤‡∏Å Disk):
    > `F_bb(E) = Norm * E^2 / (exp(E/kT) - 1)`
    *   **kT**: ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ (keV)

*   **Gaussian Line** (‡πÄ‡∏™‡πâ‡∏ô Emissions):
    > `F_gauss(E) = Norm * (1 / (sigma * sqrt(2œÄ))) * exp(-(E - E_line)^2 / (2 * sigma^2))`
    *   **E_line**: ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏™‡∏á (‡πÄ‡∏ä‡πà‡∏ô 6.4 keV)
    *   **sigma (œÉ)**: ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏™‡πâ‡∏ô

*   **Interstellar Absorption** (‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏î‡∏Å‡∏•‡∏∑‡∏ô‡πÅ‡∏™‡∏á):
    > `M(E) = F_total(E) * exp(-nH * sigma_abs(E))`
    *   **nH**: ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÅ‡∏Å‡πä‡∏™ (Hydrogen Column Density)

### 2. Fitting Statistic (‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î‡∏ú‡∏•)
‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤ **Chi-Squared (Œß¬≤)** ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡∏Å‡∏£‡∏≤‡∏ü‡∏ó‡∏§‡∏©‡∏é‡∏µ "‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô" ‡∏Å‡∏±‡∏ö‡∏Å‡∏£‡∏≤‡∏ü‡∏à‡∏£‡∏¥‡∏á‡πÅ‡∏Ñ‡πà‡πÑ‡∏´‡∏ô:

> `Chi^2 = Sum [ (Counts_i - Model_i)^2 / Error_i^2 ]`

*   **Reduced Chi-Squared (Œß¬≤_red):**
    > `Chi^2_red = Chi^2 / (N - k)`
    *   **N**: ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Data bins)
    *   **k**: ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ (Free parameters)
    *   *‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏Å‡∏•‡πâ 1.0 (‡∏ñ‡πâ‡∏≤ > 1.5 ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤ Fit ‡πÑ‡∏°‡πà‡∏î‡∏µ, < 0.8 ‡∏≠‡∏≤‡∏à‡∏à‡∏∞ Overfit)*

---

## üîÑ Algorithm Flow (‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•)

‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á `spectral_analysis.ipynb` ‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î **Chain Fit** ‡πÄ‡∏õ‡πá‡∏ô‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:

```text
[Start: Load Data]
      |
      V
[Filter Energy Range]
      |
      V
[Step 1: Fit Powerlaw Only] --------> Get Best Params (P1)
      |                                       |
      V                                       V
[Step 2: Add Reflection] <----------- Init with P1
      |
      V
[Minimize Chi-Squared] -------------> Get Best Params (P2)
      |                                       |
      V                                       V
[Step 3: Add TBabs] <---------------- Init with P2
      |
      V
[...Continue Chain...]
      |
      V
[Step 5: Full Model]
      |
      V
[Final Result & Residual Plot]
```

**‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£ Optimize (‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞ Step):**
1.  **Input:** ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏à‡∏≤‡∏Å Step ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤)
2.  **Combine Model:** ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡∏ó‡∏§‡∏©‡∏é‡∏µ‡∏à‡∏≤‡∏Å‡∏™‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (`combined_model`)
3.  **Fold Response:** ‡∏ô‡∏≥‡∏Å‡∏£‡∏≤‡∏ü‡∏ó‡∏§‡∏©‡∏é‡∏µ‡πÑ‡∏õ‡∏Ñ‡∏π‡∏ì‡∏Å‡∏±‡∏ö ARF (Effective Area) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢ Counts/sec
4.  **Compare:** ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤ **Chi-Squared**
5.  **Adjust:** ‡πÉ‡∏ä‡πâ‡∏≠‡∏±‡∏•‡∏Å‡∏≠‡∏£‡∏¥‡∏ó‡∏∂‡∏° `L-BFGS-B` ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ ‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡∏ô‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠ 2-4 ‡∏ã‡πâ‡∏≥‡πÜ
6.  **Converge:** ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡πà‡∏≤ Chi-Squared ‡∏ï‡πà‡∏≥‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏•‡∏î‡∏•‡∏á‡πÅ‡∏•‡πâ‡∏ß -> **‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö**

---

## üõ†Ô∏è Dependencies
- `numpy`: Calculation
- `matplotlib`: Visualization
- `astropy`: FITS I/O
- `scipy`: Optimization algorithms

---
*Created for AGN Spectral Analysis Research*
